<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h2 { display:inline-block; }
        #logoutBtn { float:right; padding:5px 10px; cursor:pointer; background:red; color:white; border:none; }
        nav { margin-bottom: 20px; }
        nav button { margin-right: 5px; padding: 10px; cursor: pointer; }
        section { display: none; }
        section.active { display: block; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        table, th, td { border: 1px solid #ccc; }
        th, td { padding: 8px; text-align: left; }
        button.action { background: red; color: white; border: none; padding: 5px 8px; cursor: pointer; }
    </style>
</head>
<body>

<h2>Admin Dashboard</h2>
<button id="logoutBtn">Logout</button>

<nav>
    <button data-tab="users">Users</button>
    <button data-tab="drivers">Drivers</button>
    <button data-tab="rides">Rides</button>
</nav>

<!-- Users Section -->
<section id="users" class="active">
    <h3>Users</h3>
    <table id="usersTable">
        <thead>
        <tr><th>ID</th><th>User Id</th><th>Full Name</th><th>Email</th><th>Password</th><th>Action</th></tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<!-- Drivers Section -->
<section id="drivers">
    <h3>Drivers</h3>
    <table id="driversTable">
        <thead>
        <tr><th>ID</th><th>Driver Id</th><th>Full Name</th><th>Email</th><th>Phone</th><th>Vehicle Model</th><th>Vehicle Number</th><th>Action</th></tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<!-- Rides Section -->
<section id="rides">
    <h3>Rides</h3>
    <table id="ridesTable">
        <thead>
        <tr><th>ID</th><th>User Id</th><th>Driver Id</th><th>Pickup</th><th>Destination</th><th>Status</th><th>Fare</th><th>Action</th></tr>
        </thead>
        <tbody></tbody>
    </table>
</section>

<script>
    const API_BASE = 'http://localhost:8080/api';
    if(sessionStorage.getItem('adminLoggedIn') !== 'true'){
        alert('Please login first!');
        window.location.href = "admin-login.html";
    }
    document.getElementById('logoutBtn').addEventListener('click', ()=>{
        sessionStorage.removeItem('adminLoggedIn');
        window.location.href = "admin-login.html";
    });
    const tabs = document.querySelectorAll('nav button');
    const sections = document.querySelectorAll('section');
    tabs.forEach(btn=>{
        btn.addEventListener('click', ()=>{
            sections.forEach(s=>s.classList.remove('active'));
            document.getElementById(btn.dataset.tab).classList.add('active');
        });
    });
    async function fetchAndRender(url, tbody, renderFn){
        try {
            const res = await fetch(url);
            if(!res.ok) throw new Error(res.status);
            const data = await res.json();
            tbody.innerHTML = data.map(renderFn).join('');
        } catch(err){
            console.error(err);
            tbody.innerHTML = `<tr><td colspan="${tbody.parentElement.querySelectorAll('th').length}" style="color:red;">Failed to load data</td></tr>`;
        }
    }

    // Render functions
    function renderUser(u){
        return `<tr>
            <td>${u.id}</td><td>${u.userId||'-'}</td><td>${u.fullName}</td><td>${u.email}</td><td>${u.password}</td>
            <td><button class="action" onclick="deleteUser(${u.id})">Delete</button></td>
        </tr>`;
    }
    function renderDriver(d){
        return `<tr>
            <td>${d.id}</td><td>${d.driverId||'-'}</td><td>${d.fullName}</td><td>${d.email}</td><td>${d.phone}</td>
            <td>${d.vehicleModel}</td><td>${d.vehicleNumber}</td>
            <td><button class="action" onclick="deleteDriver(${d.id})">Delete</button></td>
        </tr>`;
    }
    function renderRide(r){
        return `<tr>
            <td>${r.id}</td><td>${r.userId||'-'}</td><td>${r.driverId||'-'}</td><td>${r.pickup}</td><td>${r.destination}</td>
            <td>${r.status}</td><td>${r.fare||'-'}</td>
            <td><button class="action" onclick="deleteRide(${r.id})">Delete</button></td>
        </tr>`;
    }
    async function loadUsers(){ await fetchAndRender(`${API_BASE}/users`, document.querySelector('#usersTable tbody'), renderUser);}
    async function loadDrivers(){ await fetchAndRender(`${API_BASE}/drivers`, document.querySelector('#driversTable tbody'), renderDriver);}
    async function loadRides(){ await fetchAndRender(`${API_BASE}/rides`, document.querySelector('#ridesTable tbody'), renderRide);}
    async function deleteUser(id){
       if(!confirm('Delete user?')) return;
      const res = await fetch(`${API_BASE}/users/${id}`, {method:'DELETE'});
       if(res.ok){ alert('Deleted!'); loadUsers(); } else alert('Failed!');
   }
    async function deleteDriver(id){
        if(!confirm('Delete driver?')) return;
        const res = await fetch(`${API_BASE}/drivers/${id}`, {method:'DELETE'});
        if(res.ok){ alert('Deleted!'); loadDrivers(); } else alert('Failed!');
   }
    async function deleteRide(id){
        if(!confirm('Delete ride?')) return;
        const res = await fetch(`${API_BASE}/rides/${id}`, {method:'DELETE'});
        if(res.ok){ alert('Deleted!'); loadRides(); } else alert('Failed!');
    }

    document.addEventListener('DOMContentLoaded', ()=>{
        loadUsers();
        loadDrivers();
        loadRides();
    });
</script>

</body>
</html>








